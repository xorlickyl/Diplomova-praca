<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Web scraping tool</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body style="background: #f9f9f9;">
<h3 style="text-align: center">Diplomova praca</h3>
<div class="row">
    <div class="col-md-4 offset-md-4" style="text-align: center">
        <form>
            <div class="form-group">
                <label>Insert scrapping URL:</label>
                <input type="text" id="url" name="url"><br>
                <input type="checkbox" id="check" name="check" value="True" checked>
                <label for="check">Find all subpage</label><br>
                <a id="send_url" type="submit" class="btn btn-primary">Visualize</a>
                <a id="scrap_url" type="submit" class="btn btn-primary">Scrap</a>
            </div>
        </form>
    </div>

</div>
<div class="row">
    <div id="div" class="col-md-4 offset-md-4"></div>
</div>

</body>
<script>
   const {ipcRenderer} = require('electron');
   const button=document.getElementById('send_url');
   const scrap_button = document.getElementById("scrap_url");

   button.addEventListener('click', function() {
        let url = document.getElementById("url").value;
        const checked = document.querySelectorAll(`input[name="check"]:checked`);
        if(checked.length>0) {
            var check = checked.value;
        }else{
            var check = "False";
        }
        var value={url,check};
        // send to main.js
        ipcRenderer.send('url', value )
    });

    scrap_button.addEventListener('click', function() {
        let url = document.getElementById("url").value;
        let check = document.getElementById("check").value;
        var value = {url, check}
        // send to main.js
        ipcRenderer.send('scrap', value);
        location.href="scrap.html";
    });

    ipcRenderer.on('finished',function (event,param) {
        if (param.hasOwnProperty("Error")) {
            alert(param.Error);
        } else {
            //html tag
            console.log(param[0]);
            tag_arr = [[param[0].element]];
            for (var i = 0; i < param[0].inner.length; i++) {
                tag_arr[i + 1] = [param[0].inner[i].element];
                if (param[0].inner[i].hasOwnProperty("inner")) {
                    for (var j = 0; j < param[0].inner[i].inner.length; j++) {
                        if(param[0].inner[i].inner[j] !==null) {
                            tag_arr[i + 1].push(param[0].inner[i].inner[j].element + " : " + param[0].inner[i].inner[j].classes);
                        }
                    }
                }
            }
            var ul = document.createElement("ul");
            ul.id = "ul0";
            document.getElementById("div").appendChild(ul);
            var li = document.createElement("li");
            var b = document.createElement("button");
            b.innerText = tag_arr[0][0];
            b.className = "btn btn-link";
            b.value=tag_arr[0][0];
            li.appendChild(b);
            document.getElementById("ul0").appendChild(li);
            for (var i = 1; i < tag_arr.length; i++) {
                var ull = document.createElement("ul");
                ull.id = "ul" + i;
                document.getElementById("ul0").appendChild(ull);
                var lii = document.createElement("li");
                var bu = document.createElement("button");
                bu.innerText = tag_arr[i][0];
                bu.value=tag_arr[i][0];
                bu.className = "btn btn-link";
                lii.appendChild(bu);
                document.getElementById("ul" + i).appendChild(lii);
                if (tag_arr[i].length > 1) {
                    var uull = document.createElement("ul");
                    uull.id = "ull" + i;
                    document.getElementById("ul" + i).appendChild(uull);
                    for (var j = 1; j < tag_arr[i].length; j++) {
                        var llii = document.createElement("li");
                        var but = document.createElement("button");
                        but.innerText = tag_arr[i][j];
                        but.className = "btn btn-link";
                        but.value=tag_arr[i][j];
                        llii.appendChild(but);
                        document.getElementById("ull" + i).appendChild(llii);
                    }
                }
            }
        }
        buttons = document.querySelectorAll(".btn-link").forEach( butto=>{
            butto.addEventListener('click', event => {
                let url = document.getElementById("url").value;
                let val = butto.getAttribute("value");
                let val_a = val.split(":")
                let tag =val_a[0].replace(" ","")
                let classes=val_a[1].replace(" ","")
                var body ={url, tag, classes};
                ipcRenderer.send('scrap_tag', body);
                location.href="scrap.html";
            })
        })

    })


</script>

</html>